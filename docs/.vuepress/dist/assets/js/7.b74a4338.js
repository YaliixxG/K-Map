(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{207:function(t,s,e){t.exports=e.p+"assets/img/no-ssr.7791a6ea.jpg"},208:function(t,s,e){t.exports=e.p+"assets/img/yes-ssr.1f02d735.jpg"},209:function(t,s,e){t.exports=e.p+"assets/img/browser-render.ff7df2a2.jpg"},210:function(t,s,e){t.exports=e.p+"assets/img/ssr-render.67ccc749.jpg"},211:function(t,s,e){t.exports=e.p+"assets/img/ssr-map.164585c9.png"},296:function(t,s,e){"use strict";e.r(s);var n=[function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"什么是-ssr-？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-ssr-？","aria-hidden":"true"}},[this._v("#")]),this._v(" 什么是 ssr ？")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("没使用服务渲染，当请求 user 页面时，返回的 body 里为空，之后执行 js 将 html 结构注入到 body 里，结合 css 显示出来")]),this._v(" "),s("p",[s("img",{attrs:{src:e(207),alt:"没有使用 ssr"}})])]),this._v(" "),s("li",[s("p",[this._v("使用了服务端渲染，当请求 user 页面时，返回的 body 里已经有了首屏的 html 结构，之后结合 css 显示出来")]),this._v(" "),s("p",[s("img",{attrs:{src:e(208),alt:"使用 ssr"}})])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"纯浏览器渲染"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#纯浏览器渲染","aria-hidden":"true"}},[this._v("#")]),this._v(" 纯浏览器渲染")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(209),alt:"浏览器渲染"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("用户在浏览器上输入网址，访问到的其实是服务器上的一个文件服务。服务器会返回给浏览器一堆文件，这些文件是你 "),s("code",[this._v("npm run build")]),this._v("打包之后生成的。其中"),s("code",[this._v("app.bundle.js")]),this._v("是你写的业务代码，而"),s("code",[this._v("index.html")]),this._v("里面是没有任何东西的，仅仅是引入了 JS 的模板。而浏览器渲染出来的页面都是通过执行 JS 来生成的，生成 html，生成 DOM。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"ssr-与-纯浏览器渲染的利弊"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ssr-与-纯浏览器渲染的利弊","aria-hidden":"true"}},[this._v("#")]),this._v(" ssr 与 纯浏览器渲染的利弊")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"纯浏览器渲染的缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#纯浏览器渲染的缺点","aria-hidden":"true"}},[this._v("#")]),this._v(" 纯浏览器渲染的缺点")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[t._v("不利于 "),e("code",[t._v("SEO")]),t._v("。"),e("code",[t._v("SEO")]),t._v("的根据是请求网站，看返回的 "),e("code",[t._v("html")]),t._v(" 文件中有没有有价值的信息。搜索引擎是利用爬虫去爬取 "),e("code",[t._v("index.html")]),t._v(" 中的关键词数据，但是在浏览器渲染中"),e("code",[t._v("index.html")]),t._v("文件爬不到任何价值信息。")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[t._v("首屏加载。\b 因为所有的业务组件信息都在"),e("code",[t._v("app.bundle.js")]),t._v("中，所以一旦要查看，就需要将这个文件加载完。无论是做异步组件，还是优化始终是没有直接加载 "),e("code",[t._v("html")]),t._v(" 速度快的。")]),t._v(" "),e("li",[t._v("浏览器压力问题。纯浏览器渲染是 \b 拿到返回的文件后，执行 "),e("code",[t._v("app.bundle.js")]),t._v("，通过"),e("code",[t._v("app.bundle.js")]),t._v("生成 "),e("code",[t._v("html")]),t._v("，在进行渲染，渲染过程中又需要发请求，再执行 "),e("code",[t._v("JS")]),t._v("重新生成 "),e("code",[t._v("html")]),t._v("。所有的工作都压在浏览器，浏览器需要处理的事情太多，所以会造成压力太大，内存占用过大，会卡崩。")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[e("strong",[t._v("核心问题：纯浏览器渲染，是需要执行 "),e("code",[t._v("JS")]),t._v("（"),e("code",[t._v("app.bundle.js")]),t._v("），再根据 "),e("code",[t._v("JS")]),t._v(" 生成 "),e("code",[t._v("html")]),t._v(" 页面。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("问题解决：将 "),s("code",[this._v("JS")]),this._v(" 的执行移到服务器去进行，减少客户端的压力，客户端只需直接接收服务端返回的 "),s("code",[this._v("html")]),this._v(" 就可以了。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"ssr-渲染"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ssr-渲染","aria-hidden":"true"}},[this._v("#")]),this._v(" ssr 渲染")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(210),alt:"服务端渲染"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#过程","aria-hidden":"true"}},[this._v("#")]),this._v(" 过程")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("浏览器请求访问某个页面，服务器接收到请求后，解析执行 "),e("code",[t._v("js")]),t._v(" 生成 "),e("code",[t._v("html")]),t._v(" 页面，将其返回给浏览器。比如"),e("code",[t._v("vue")]),t._v("，解析 "),e("code",[t._v("JS")]),t._v(" 时，"),e("code",[t._v("JS")]),t._v(" 里面全部都是"),e("code",[t._v(".vue")]),t._v("的文件，也就是 "),e("code",[t._v("vue")]),t._v(" 实例，服务器就是要将这些实例转成字符串形式的 "),e("code",[t._v("html")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"为什么-node"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么-node","aria-hidden":"true"}},[this._v("#")]),this._v(" 为什么 "),s("code",[this._v("Node")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("作为服务端语言，解析 "),s("code",[this._v("JS")]),this._v(" 最好的肯定是 "),s("code",[this._v("Node")]),this._v(" 了")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"node-vue-vue-server-renderer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-vue-vue-server-renderer","aria-hidden":"true"}},[this._v("#")]),this._v(" Node + Vue + vue-server-renderer")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("vue-server-renderer")]),this._v(": "),s("code",[this._v("npm install vue-server-renderer")]),this._v("，这个包主要是提供 Vue 2.0 的 Node.js 服务器端呈现")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vue "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" server "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建一个 renderer 实例")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" renderer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue-server-renderer'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRenderer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据请求的地址，生成对应的vue 实例的方法")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createApp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// doSth")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createApp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将Vue实例呈现为字符串。 回调是一个标准的Node.js回调，它接收错误作为第一个参数")]),t._v("\n    renderer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderToString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" html")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("html"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserver"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特性","aria-hidden":"true"}},[this._v("#")]),this._v(" 特性")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("以"),s("code",[this._v("vue")]),this._v("项目说明")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[t._v("每一次访问必须新建一个 vue 实例")]),t._v(" "),e("li",[t._v("只会触发组件的 "),e("code",[t._v("beforeCreate")]),t._v(" 和 "),e("code",[t._v("created")]),t._v(" 钩子，所以需要客户端 JS"),e("br"),t._v("\n服务端解析 JS 时，看上面的代码可知生命周期只会进行到 "),e("code",[t._v("created")]),t._v(" 阶段，也就是生成实例的阶段，实例生成后即会被转成字符串形式的 "),e("code",[t._v("html")]),t._v(" 返回给客户端。所以挂载实例的"),e("code",[t._v("mounted")]),t._v("的阶段是没有的，而后续的交互操作（点击事件，鼠标移动事件...）不可能在服务端执行，只能在浏览器上面完成，所以客户端需要有 JS 去执行这些操作，不可能把所有的 JS 都放在服务器。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"ssr-工程化流程图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ssr-工程化流程图","aria-hidden":"true"}},[this._v("#")]),this._v(" ssr 工程化流程图")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:e(211),alt:"工程化流程图"}})])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ol",[e("li",[e("code",[t._v("Source")]),t._v("部分：应用代码平常只会有一个入口文件，打包后也只会生成一个 JS 文件。但是现在需要配置两个入口，服务端入口和客户端入口。")]),t._v(" "),e("li",[t._v("由于有两个入口文件，所以webpack 需进行两次打包，生成 "),e("code",[t._v("server.bundle.js")]),t._v(" 和 "),e("code",[t._v("client.bundle.js")]),t._v("。")]),t._v(" "),e("li",[t._v("在 node 服务器中，"),e("code",[t._v("server.bundle.js")]),t._v("的作用主要是根据请求的地址生成实例，再通过"),e("code",[t._v("Bundle Renderer")]),t._v(" 将其生成字符串形式的 html，并返回给浏览器。")]),t._v(" "),e("li",[t._v("浏览器接收到服务端返回的 html后，再配合"),e("code",[t._v("client.bundle.js")]),t._v("进行渲染，后续就由浏览器进行操作了。")]),t._v(" "),e("li",[e("code",[t._v("hydrate")]),t._v(" 描述的是 "),e("code",[t._v("DOM")]),t._v(" 复用服务端渲染的内容时尽可能保留结构，并补充事件绑定等 "),e("code",[t._v("Client")]),t._v(" 特有内容的过程。")])])}],r=e(0),a=Object(r.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[e("h1",{attrs:{id:"ssr-服务端渲染"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssr-服务端渲染","aria-hidden":"true"}},[t._v("#")]),t._v(" "),e("font",{attrs:{color:"#fdd333"}},[t._v("ssr 服务端渲染")])],1),t._v(" "),t._m(0),t._v(" "),e("p",[t._v('简单理解是将组件或页面通过服务器生成 html 字符串，再发送到浏览器，最后将静态标记"混合"为客户端上完全交互的应用程序')]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),e("p",[t._v("####如何解决纯浏览器渲染的问题，为什么要用 ssr")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25)])},n,!1,null,null,null);s.default=a.exports}}]);